{% extends 'admin1/base1.html' %}

{% block content %}

<!-- Custom Styles -->
<style>
    .container {
        padding: 24px;
    }

    .card {
        background-color: white;
        padding: 24px;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        margin-bottom: 32px;
    }

    .form-grid {
        display: grid;
        grid-template-columns: 2fr 1fr 1fr 1fr;
        gap: 16px;
        align-items: end;
    }

    .form-row {
        display: grid;
        grid-template-columns: 2fr 1fr 1fr 1fr 1fr;
        gap: 16px;
        align-items: center;
        border-bottom: 1px solid #ddd;
        padding: 16px 0;
    }

    label {
        display: block;
        font-weight: 500;
        margin-bottom: 4px;
        color: #333;
    }

    input[type="text"],
    input[type="number"],
    select {
        width: 100%;
        padding: 8px;
        border: 1px solid #ccc;
        border-radius: 4px;
    }

    button {
        padding: 8px 16px;
        border: none;
        border-radius: 4px;
        color: white;
        cursor: pointer;
    }

    .btn-add {
        background-color: #3b82f6;
    }

    .btn-add:hover {
        background-color: #2563eb;
    }

    .btn-update {
        background-color: #10b981;
    }

    .btn-update:hover {
        background-color: #059669;
    }

    .btn-delete {
        background-color: #ef4444;
    }

    .btn-delete:hover {
        background-color: #dc2626;
    }

    h2, h3 {
        margin-bottom: 16px;
        font-weight: bold;
    }

    .text-muted {
        color: #666;
    }

    .error-message {
        color: #dc3545;
        font-size: 0.9em;
        margin-top: 4px;
    }

    @media (max-width: 768px) {
        .form-grid,
        .form-row {
            grid-template-columns: 1fr;
        }
    }
</style>

<div class="container">
    <h2>Admin Dashboard - Manage Questions</h2>

    <!-- Add Question Form -->
    <div class="card">
        <h3>Add New Question</h3>
        {% if errors %}
            <div class="error-message">
                {% for key, value in errors.items %}
                    <p>{{ key }}: {{ value }}</p>
                {% endfor %}
            </div>
        {% endif %}
        <form method="post" class="form-grid">
            {% csrf_token %}
            <input type="hidden" name="action" value="add">

            <div>
                <label for="text">Question Text</label>
                <input type="text" name="text" id="text" required>
            </div>

            <div>
                <label for="category">Category</label>
                <select name="category" id="category" required>
                    <option value="Tech">Tech</option>
                    <option value="Creative">Creative</option>
                    <option value="Analytical">Analytical</option>
                    <option value="Collaborative">Collaborative</option>
                </select>
            </div>

            <div>
                <label for="parent_question">Parent Question</label>
                <select name="parent_question" id="parent_question">
                    <option value="">No Parent</option>
                    {% for q in all_questions %}
                        <option value="{{ q.id }}">{{ q.text }}</option>
                    {% endfor %}
                </select>
            </div>

            <div>
                <label for="required_answer">Required Answer</label>
                <input type="number" name="required_answer" id="required_answer" min="1" max="5" placeholder="1-5">
            </div>

            <div style="grid-column: span 4;">
                <button type="submit" class="btn-add">Add Question</button>
            </div>
        </form>
    </div>

    <!-- Question List -->
    <div class="card">
        <h3>Existing Questions</h3>
        {% if questions %}
            {% for question in questions %}
            <form method="post" class="form-row">
                {% csrf_token %}
                <input type="hidden" name="action" value="edit">
                <input type="hidden" name="question_id" value="{{ question.id }}">

                <div>
                    <label>Question Text</label>
                    <input type="text" name="text" value="{{ question.text }}" required>
                </div>

                <div>
                    <label>Category</label>
                    <select name="category" required>
                        <option value="Tech" {% if question.category == 'Tech' %}selected{% endif %}>Tech</option>
                        <option value="Creative" {% if question.category == 'Creative' %}selected{% endif %}>Creative</option>
                        <option value="Analytical" {% if question.category == 'Analytical' %}selected{% endif %}>Analytical</option>
                        <option value="Collaborative" {% if question.category == 'Collaborative' %}selected{% endif %}>Collaborative</option>
                    </select>
                </div>

                <div>
                    <label>Parent Question</label>
                    <select name="parent_question">
                        <option value="">No Parent</option>
                        {% for q in all_questions %}
                            <option value="{{ q.id }}" {% if q == question.parent_question %}selected{% endif %}>{{ q.text }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div>
                    <label>Required Answer</label>
                    <input type="number" name="required_answer" value="{{ question.required_answer|default_if_none:'' }}" min="1" max="5" placeholder="1-5">
                </div>

                <div style="display: flex; gap: 8px;">
                    <button type="submit" class="btn-update">Update</button>
                    <button type="submit" formaction="{% url 'admin_dashboard' %}" formmethod="post" name="action" value="delete" class="btn-delete">
                        <input type="hidden" name="question_id" value="{{ question.id }}">Delete
                    </button>
                </div>
            </form>
            {% endfor %}
        {% else %}
            <p class="text-muted">No questions available. Add some above!</p>
        {% endif %}
    </div>
</div>
{% endblock %}